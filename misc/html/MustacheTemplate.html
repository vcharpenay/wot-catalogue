{{!
  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
  PREFIX ex: <http://example.org/>
  PREFIX ontolex: <http://www.w3.org/ns/lemon/ontolex#>
}}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>WoT Catalogue</title>
        <script src="js/lunr.js"></script>
        <style>
            body {
                font-family: sans-serif;
                margin: 0;
            }

            #main {
                max-width: 640px;
                margin: auto;
            }

            #header {
                height: 120px;
            }

            #header * {
                text-align: center;
            }

            #header #subtitle {
                color: white;
                background: linear-gradient(90deg, #c85a19, black);
                margin: 0;
                padding: 5px;
            }

            #search {
                padding: 10px;
            }

            #keywords {
                width: calc(100% - 100px);
            }

            #search-btn {
                width: 80px;
            }

            #search-feedback {
                font-style: italic;
                color: lightgrey;
            }

            .concept {
                display: none;
                border: 1px solid lightgrey;
                padding: 10px;
                margin-bottom: 10px;
            }

            .concept.selected {
                display: block;
            }
        </style>
    </head>
    <body>
        <div id="main">
            <div id="header">
                <p id="subtitle">Web of Things (WoT) Catalogue</p>
                <h1>Web of Things (WoT) Catalogue - Extended</h1>
            </div>
            <div id="search">
                <input id="keywords" placeholder="Search concepts by keyword...">
                <input id="search-btn" type="button" value="Search">
                <p id="search-feedback"><span id="search-count">?</span> concept(s) found</p>
            </div>
            {{#ex:skosConcept}}
                <div id="{{ex:identifier}}" class="concept">
                    <h1>{{skos:prefLabel}}</h1>
                    {{#ex:highLevel}}
                        <h3>High-level concept</h3>
                    {{/ex:highLevel}}
                    <span style="font-size:small">
                        URI: 
                        <code>
                            <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{ex:hasURI}}</a>
                        </code>
                        {{#skos:inScheme}}
                            , Source: 
                            <code>
                                <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{skos:prefLabel}}</a>
                            </code>
                        {{/skos:inScheme}}
                    </span>
                    {{#ex:description}}
                        <p>Description</p>
                        <span style="font-size:small">
                            {{skos:definition}}
                        </span>
                    {{/ex:description}}
                    {{#ex:broad}}
                        <p>Broader concept:</p>
                        <ul>
                            {{#skos:broader}}
                                <li>
                                    <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{skos:prefLabel}}</a>
                                </li>
                            {{/skos:broader}}
                        </ul>
                    {{/ex:broad}}
                    {{#ex:narrow}}
                        <p>Narrower concept(s):</p>
                        <ul>
                            {{#skos:narrower}}
                                <li>
                                    <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{skos:prefLabel}}</a>
                                </li>
                            {{/skos:narrower}}
                        </ul>
                    {{/ex:narrow}}
                    {{#ex:relations}}
                        <p>Related concepts:</p>
                        <ul>
                            {{#skos:related}}
                                <li>
                                    <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{skos:prefLabel}}</a>
                                </li>
                            {{/skos:related}}
                        </ul>
                    {{/ex:relations}}
                    {{#ex:wikidata}}
                        <p>Related Wikidata entities:</p>
                        <ul>
                            {{#ontolex:isEvokedBy}}
                                <li>
                                    <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{skos:prefLabel}} ({{ex:hasID}})</a>
                                </li>
                            {{/ontolex:isEvokedBy}}
                        </ul>
                    {{/ex:wikidata}}
                </div>
            {{/ex:skosConcept}}
            {{#ex:skosConceptScheme}}
                <div id="{{ex:identifier}}" class="concept">
                    <h1>{{skos:prefLabel}}</h1>
                    <h2>Concept Scheme</h2>
                    <span style="font-size:small">
                        URI: 
                        <code>
                            <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{ex:hasURI}}</a>
                        </code>
                    </span>
                    {{#ex:description}}
                        <p>Description</p>
                        <span style="font-size:small">
                            {{skos:definition}}
                        </span>
                    {{/ex:description}}
                        <p>Top Concept:</p>
                        {{#skos:hasTopConcept}}
                            <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{skos:prefLabel}}</a>
                        {{/skos:hasTopConcept}}
                    {{#ex:relations}}
                        <p>Related concepts:</p>
                        <ul>
                            {{#skos:related}}
                                <li>
                                    <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{skos:prefLabel}}</a>
                                </li>
                            {{/skos:related}}
                        </ul>
                    {{/ex:relations}}
                    {{#ex:wikidata}}
                        <p>Related Wikidata entities:</p>
                        <ul>
                            {{#ontolex:isEvokedBy}}
                                <li>
                                    <a href="{{ex:hasURI}}" target="_blank" rel="nofollow noopener noreferrer">{{skos:prefLabel}} ({{ex:hasID}})</a>
                                </li>
                            {{/ontolex:isEvokedBy}}
                        </ul>
                    {{/ex:wikidata}}
                </div>
            {{/ex:skosConceptScheme}}
        </div>
        <script>
            const conceptDivs = document.querySelectorAll('.concept');
            const keywordsInput = document.getElementById('keywords');
            const searchBtnInput = document.getElementById('search-btn');
            const searchCountText = document.getElementById('search-count');

            // build index
            
            const idx = lunr(function () {
                let builder = this;

                builder.ref('id');
                builder.field('id');
                builder.field('title');

                conceptDivs.forEach(function(e) {
                    builder.add({
                        id: e.id,
                        title: e.querySelector('h1').innerText
                    });
                });
            });

            // search index

            function search(kw) {
                let results = idx.search(kw);

                conceptDivs.forEach(function(e) {
                    e.classList.remove('selected');
                });

                searchCountText.innerText = results.length;

                results.forEach(function(res) {
                    document.getElementById(res.ref).classList.add('selected');
                });
            }

            searchBtnInput.onclick = function() {
                let kw = keywordsInput.value;

                if (document.location.hash != `#${kw}`) {
                    document.location.hash = kw;
                } else {
                    search(kw);
                }
            };

            window.onhashchange = function() {
                let fragment = document.location.hash;

                if (fragment.length > 0) {
                    let kw = fragment.substring(1);

                    if (keywordsInput.value != kw) {
                        keywordsInput.value = kw;
                        searchBtnInput.onclick();
                    } else {
                        search(kw);
                    }
                }
            };

            window.onhashchange();
        </script>
    </body>
</html>
